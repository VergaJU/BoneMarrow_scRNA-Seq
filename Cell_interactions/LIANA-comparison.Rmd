---
title: "ALRA-comparisons"
author: "Jacopo Umberto Verga"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE, message = FALSE)
```

# ALRA interactions

I run ALRA using all the healthy samples with NK cells divided in exhausted and resident. The results are:

```{r}
library(tidyverse)
library(VennDiagram)
library(stringr) 
set.seed(1)
mm_interactions <- read_csv("all_interactions_defaults.csv", col_types = cols(...1 = col_skip()))
ht_interactions <- read_csv("all_healthy_interactions_default.csv", col_types = cols(...1 = col_skip()))


exh_mm = mm_interactions %>%
  filter(target == "NK exhausted")

res_mm = mm_interactions %>%
  filter(target == "NK resident")

exh_ht = ht_interactions %>%
  filter(target == "NK exhausted")

res_ht = ht_interactions %>%
  filter(target == "NK resident")
```

```{r }

variables = c("Total number of interactions", "Different Ligands", "Different Receptors")

mm = c(dim(mm_interactions)[1],
       length(unique(sort(mm_interactions$ligand.complex))),
       length(unique(sort(mm_interactions$receptor.complex))))

mm_nk_exh = c(dim(exh_mm)[1],
           length(unique(sort(exh_mm$ligand.complex))),
           length(unique(sort(exh_mm$receptor.complex))))
  
mm_nk_res = c(dim(res_mm)[1],
           length(unique(sort(res_mm$ligand.complex))),
           length(unique(sort(res_mm$receptor.complex))))
  
df_mm <- data.frame(variables, mm, mm_nk_exh, mm_nk_res) %>%
  mutate(nk_exh_ratio = round((mm_nk_exh/mm)*100,1)) %>%
  mutate(nk_res_ratio = round((mm_nk_res/mm)*100,1))



ht = c(dim(ht_interactions)[1],
       length(unique(sort(ht_interactions$ligand.complex))),
       length(unique(sort(ht_interactions$receptor.complex))))


ht_nk_exh = c(dim(exh_ht)[1],
           length(unique(sort(exh_ht$ligand.complex))),
           length(unique(sort(exh_ht$receptor.complex))))
  
ht_nk_res = c(dim(res_ht)[1],
           length(unique(sort(res_ht$ligand.complex))),
           length(unique(sort(res_ht$receptor.complex))))

                 
df_ht <- data.frame(variables, ht, ht_nk_exh, ht_nk_res) %>%
  mutate(nk_exh_ratio = round((ht_nk_exh/ht)*100,1)) %>%
  mutate(nk_res_ratio = round((ht_nk_res/ht)*100,1))

df_mm

df_ht
```

Lower number of interactions, ligands and receptors found in healthy samples. For both the condition NK cells take account of ~ 10% of the interactions. Each call state (resident or exhausted) take account of $\sim \frac{1}{3}$ ligands and receptors. Now have a deeper look in the ligands.

# Ligands

Check the ligands ective in MM and healthy cells, then with a focus on NK cells

```{r fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
#mm_interactions["Condition"] = "MM"
#ht_interactions["Condition"] = "Healthy"
#all_interactions = rbind(mm_interactions, ht_interactions)
mm_ligands = unique(sort(mm_interactions$ligand.complex))
ht_ligands = unique(sort(ht_interactions$ligand.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_ligands, ht_ligands),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)

```

56.8% of ligands are active in both healthy and MM samples, what about the ligands in NK cells?

```{r}
mm_nk = mm_interactions %>%
  filter(target == "NK resident" | target == "NK exhausted")

mm_ligands = unique(sort(mm_nk$ligand.complex))


ht_nk = ht_interactions %>%
  filter(target == "NK resident" | target == "NK exhausted")

ht_ligands = unique(sort(ht_nk$ligand.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_ligands, ht_ligands),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

52.3% of ligands shared by the two conditions. Interestingly MM samples have 56 ligands uniquely active (43.8%)


```{r}
cat("Ligands active only in healthy NK cells:\n", setdiff(ht_ligands,mm_ligands), "\nLigands active only in MM NK cells (subset of 5):\n", sample(setdiff(mm_ligands,ht_ligands),5))
```

### Healthy:

- CD34, expressed by HSCs & MPPS, binds SELL in resident and exhausted NK cells
- IGF1, expressed by Plasma cell, binds IGF2R in NK exhausted. [Promotes cytotoxic activity](https://www.nature.com/articles/ncomms2484)
- PTDSS1, expressed by Conventional dendritic cell 1, binds JMJD6 in resident NK cells
- TOR2A, expressed by Conventional dendritic cell 1, binds ATP5F1B in resident NK cells

### MM

- ARF6, expressed by NK and dendritic cells, bind SMAP1 of NK exhausted. [responds to FCG3A activation](https://www.sciencedirect.com/science/article/pii/S0006497120532825) 
- LTB, expressed by many cells, binds TNFRSF1A of exhausted and resident NK cells
- ACTR2/HSPA8, expressed by many cells, binds ADRB2 of exhausted and resident NK cells. [ADRB2 deletion impair NK activity](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7144534/)
- GZMA, expressed by many cells, binds F2R of exhausted and resident NK cells. [GZMA/F2R/JAK2/STAT1 signaling promoted apoptosis](https://www.nature.com/articles/s41419-022-04654-7) of tumor cells: 
  - apoptosis NK cells?

Now compare exhausted and resident cells between the conditions:

## Exhausted NK cells:

```{r}
mm_ligands = unique(sort(exh_mm$ligand.complex))

ht_ligands = unique(sort(exh_ht$ligand.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_ligands, ht_ligands),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

A minority of ligands is active in healthy samples compared to MM exhausted NK cells. Also, Exhausted NK cells in MM have 62 active ligands that aren't present in healthy samples. Only 5 ligands are uniquely active in healthy samples


```{r}
set.seed(1)
cat("Ligands active only in healthy exhausted NK cells:\n", setdiff(ht_ligands,mm_ligands), "\nLigands active only in MM exhausted NK cells (subset of 5):\n", sample(setdiff(mm_ligands,ht_ligands),5))
```

## Resident NK cells:

```{r}
mm_ligands = unique(sort(res_mm$ligand.complex))

ht_ligands = unique(sort(res_ht$ligand.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_ligands, ht_ligands),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

A minority of ligands is active in healthy samples compared to MM resident NK cells. Also, Exhausted NK cells in MM have 39 active ligands that aren't present in healthy samples. Only 5 ligands are uniquely active in healthy samples



```{r}
set.seed(1)
cat("Ligands active only in healthy NK cells:\n", setdiff(ht_ligands,mm_ligands), "\nLigands active only in MM NK cells (subset of 5):\n", sample(setdiff(mm_ligands,ht_ligands),5))
```


# Receptors


Check the receptors active in MM and healthy cells, then focus on NK cells

```{r fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
#mm_interactions["Condition"] = "MM"
#ht_interactions["Condition"] = "Healthy"
#all_interactions = rbind(mm_interactions, ht_interactions)
mm_receptors = unique(sort(mm_interactions$receptor.complex))
ht_receptors = unique(sort(ht_interactions$receptor.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_receptors, ht_receptors),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)

```

59.9% receptors are active in both healthy and MM samples. MM samples have more active receptors compared to healthy samples. What about the receptors in NK cells?

```{r}

mm_receptors = unique(sort(mm_nk$receptor.complex))
ht_receptors = unique(sort(ht_nk$receptor.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_receptors, ht_receptors),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

62.2% receptors are shared by the two conditions. Only 6 receptors are activated uniquely in healthy samples while 28 (31.1%) are uniquely active in MM samples.


```{r}
set.seed(1)
cat("Ligands active only in healthy NK cells:\n", setdiff(ht_receptors,mm_receptors), "\nLigands active only in MM NK cells (subset of 6):\n", sample(setdiff(mm_receptors,ht_receptors),6))
```
- CD44_CD74 CD74 CD74_CXCR4 complexes, inhibitory, are  active only in healthy samples.


Now compare exhausted and resident cells between the conditions:

## Exhausted NK cells:

```{r}
mm_receptors = unique(sort(exh_mm$receptor.complex))

ht_receptors = unique(sort(exh_ht$receptor.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_receptors, ht_receptors),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

61.2% of receptors are shared by exhausted NK cells between the conditions. As seen reviously, healthy samples have only 4 receptors active that aren't present in MM samples. MM have 29 receptors uniquely activated.


```{r}
set.seed(1)
cat("Receptors active only in healthy exhausted NK cells:\n", setdiff(ht_receptors,mm_receptors), "\nReceptors active only in MM exhausted NK cells (subset of 4):\n", sample(setdiff(mm_receptors,ht_receptors),4))
```

## Resident

```{r}
mm_receptors = unique(sort(res_mm$receptor.complex))

ht_receptors = unique(sort(res_ht$receptor.complex))

grid.newpage()
venn_object <- venn.diagram(
        x = list(mm_receptors, ht_receptors),
        category.names = c("MM", "Healthy"),
        print.mode=c("raw","percent"),
        fill = c("green", "yellow"),
        alpha=0.3,
        filename = NULL,
        disable.logging=TRUE
        )
grid.draw(venn_object)
```

Still 59% of shared receptors in resident NK cells. Healthy samples have 6 unique receptors:

```{r}
set.seed(1)
cat("Receptors active only in healthy NK cells:\n", setdiff(ht_receptors,mm_receptors), "\nReceptors active only in MM NK cells (subset of 6):\n", sample(setdiff(mm_receptors,ht_receptors),6))
```

- [CD44/CD74/CXCR4](https://doi.org/10.3389/fimmu.2020.609948): inhibits NK citotoxycity, interesting found only in healthy cells.
- LAMP1, ligand FAM3C, important for NK cytotoxycity


## Number of interacting cells

Evaluate the proportion of celltypes that interacts with our NK cells in the two conditions:

```{r}
mm_source <- as.data.frame(table(mm_nk$source)/sum(table(mm_nk$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(ht_nk$source)/sum(table(ht_nk$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="healty")

source <- rbind(mm_source,ht_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = celltype,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
  geom_hline(yintercept = 0, color="white")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(celltype,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```

Different proportions od interacting celtype were found between healthy and MM sampes:
- Conventional dendritic cells 1 interact more with healthy NK cells than MM
- Non-classical monocytes and Megakaryocyte progenitors interact more with MM than healthy NK cells


## Exhausted NK cells:



```{r}
mm_source <- as.data.frame(table(exh_mm$source)/sum(table(exh_mm$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(exh_ht$source)/sum(table(exh_ht$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="healty")

source <- rbind(mm_source,ht_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = celltype,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
  geom_hline(yintercept = 0, color="white")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(celltype,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```

Some differences in the cells that interact with exhausted NK cells between MM and healthy can be highlighted:
- proportionally, Conventional dendritic cell 2, myelocytes, non-classical monocytes, early erythroid progenitors, lymphomyeloid progenitor interacts more with exhausted cells in MM than in healthy samples
- proportionally, CD8+ em T cell, erythro-myeloid progenitors, pre-B cells, CD8+ naive T cells, CD4+ nave T cells, CD69+PD-1+ memory CD4+ T cells, Pro-B cells interacts more with exhausted cells in healthy than in MM samples
- More adaptive-immune cells interactions in healthy than MM

## Resident NK cells: 


```{r}
mm_source <- as.data.frame(table(res_mm$source)/sum(table(res_mm$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(res_ht$source)/sum(table(res_ht$source))) %>%
  rename(celltype = "Var1") %>%
  mutate(condition="healty")

source <- rbind(mm_source,ht_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = celltype,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
  geom_hline(yintercept = 0, color="white") +
  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(celltype,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```


Some differences in the cells that interact with resident NK cells between MM and healthy can be highlighted:
- non-classical monocytes, early erythroid progenitors, lymphomyeloid progenitor interacts more with exhausted cells in MM than in healthy samples
- A hughe proportion of interaction come from Conventional dendritic cell 1 in healthy samples, in MM samples this proportion is lower
- The main difference is in conventional dendritic cells 1


# Number of interacting ligands

Now let's check the receptors that receive most interactions


```{r fig.width=10}
mm_source <- as.data.frame(table(mm_nk$receptor.complex)/sum(table(mm_nk$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(ht_nk$receptor.complex)/sum(table(ht_nk$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(mm_source[1:10,],ht_source[1:10,])

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white") +
  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```


## Exhausted NK cells: 


```{r fig.width=10}
mm_source <- as.data.frame(table(exh_mm$receptor.complex)/sum(table(exh_mm$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(exh_ht$receptor.complex)/sum(table(exh_ht$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(mm_source[1:10,],ht_source[1:10,])

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white") +
  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```

## Resident NK cells:


```{r fig.width=10}
mm_source <- as.data.frame(table(res_mm$receptor.complex)/sum(table(res_mm$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
ht_source <- as.data.frame(table(res_ht$receptor.complex)/sum(table(res_ht$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(mm_source[1:10,],ht_source[1:10,])

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white") +
  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```


# Immune checkpoint receptors:

Now have a look on the immune checkpoint receptors:

```{r}

ICR = c("KLRB1|KLRC1|KLRD1|KIR2DL1|KIR2DL3|KIR3DL1|KIR3DL2|KLRG1|KIR2DL4|TIGIT|LAG3|HAVCR2|BTLA|PDCD1|LILRB1|LILRB2|LILRB3|LILRB4|LILRB5|SIGLEC7|LAIR1|CEACAM1|PILRA|CD300A|CD96")

mm_ICR <- mm_nk %>%
  filter(grepl(ICR,receptor.complex)) %>%
  filter(!grepl("KLRC2|KLRC3", receptor.complex))

ht_ICR <- ht_nk %>%
  filter(grepl(ICR,receptor.complex)) %>%
  filter(!grepl("KLRC2|KLRC3", receptor.complex))


cat("MM cells:\nTotal number of ICR interactions: ",dim(mm_ICR)[1],"\nUnique Ligands: ",length(unique(sort(mm_ICR$ligand.complex))),"\nUnique Receptors: ",length(unique(sort(mm_ICR$receptor.complex))),"\n\n")
cat("Healthy cells:\nTotal number of interactions: ",dim(ht_ICR)[1],"\nUnique Ligands: ",length(unique(sort(ht_ICR$ligand.complex))),"\nUnique Receptors: ",length(unique(sort(ht_ICR$receptor.complex))))
```

Lower intreaction, receptors and ligands related to immune checkpoint are found in healthy samples compared to MM



```{r}
exh_source <- as.data.frame(table(mm_ICR$receptor.complex)/sum(table(mm_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
res_source <- as.data.frame(table(ht_ICR$receptor.complex)/sum(table(ht_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(res_source,exh_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white")+

  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```


- TIGIT, LAG3, LILRB1, KLRG1, KIR2DL1, CD96/TACTILE are activated only in MM
- LAIR1 receive proportionally more interactions in healthy cells (and in absolute numbers):

```{r}
cat("MM:", table(mm_ICR$receptor.complex[mm_ICR$receptor.complex == "LAIR1"]), "\nHealthy:", table(ht_ICR$receptor.complex[ht_ICR$receptor.complex == "LAIR1"]))
```
- HAVCR2/TIM3 acivated in both  the conditions

Let's focus on exhausted and resident nk cells


## Exhausted NK cells:

```{r}
mm_exh_ICR <- mm_ICR[mm_ICR$target == "NK exhausted", ]
ht_exh_ICR <- ht_ICR[ht_ICR$target == "NK exhausted", ]


exh_source <- as.data.frame(table(mm_exh_ICR$receptor.complex)/sum(table(mm_exh_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
res_source <- as.data.frame(table(ht_exh_ICR$receptor.complex)/sum(table(ht_exh_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(res_source,exh_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white")+

  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```

- TIGIT, LILRB1, LAG3, KLRG1, CD96/TACTILE are activated only in MM
- LAIR1 activated only in healthy cells
- HAVCR2/TIM3 activated in both the conditions


## Resident NK cells:

```{r}
mm_res_ICR <- mm_ICR[mm_ICR$target == "NK resident", ]
ht_res_ICR <- ht_ICR[ht_ICR$target == "NK resident", ]


exh_source <- as.data.frame(table(mm_res_ICR$receptor.complex)/sum(table(mm_res_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="MM")
res_source <- as.data.frame(table(ht_res_ICR$receptor.complex)/sum(table(ht_res_ICR$receptor.complex))) %>%
  arrange(desc(Freq)) %>%
  rename(receptor = "Var1") %>%
  mutate(condition="healthy")

source <- rbind(res_source,exh_source)

source_plot <- source %>%
  mutate(
    Freq = ifelse(condition=="MM", Freq*(-1),
                        Freq*1))%>%
    ggplot(aes(x = receptor,y = Freq, fill=condition)) +
    geom_bar(stat = "identity") +
    coord_flip() +
    geom_hline(yintercept = 0, color="white")+

  theme(legend.position = "top")

source_plot

source_dodge <- ggplot(source, aes(x=reorder(receptor,-Freq), y=Freq, fill=condition)) +
geom_bar(stat="identity", color="black", position=position_dodge())+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

source_dodge
```

- KLRG1, KIR2DL3, KIR2DL1, HAVCR2, CD96 active in MM
- LAIR1 more active in healthy than MM samples
- HAVCR2/TIM3 activated only in MM


# Conclusions

- MM samples present higher number of:
  - Interactions
  - Receptors
  - Ligands
- More ICR have been found in MM compared to healthy samples in both:
  - Exhausted NK cells
  - Resident NK cells
- The main ICR activated in healthy cells are KIRs/KLRs and HAVCR2/TIM3, LAIR1
- TIGIT, LAG3, LILRB1, KLRG1, KIR2DL1, CD96/TACTILE are activated only in MM
- Many ICR are activated in resident NK cells from MM while healthy resident NK cell lack this activation


# Next step

Since differences in ICR were found between MM and heathy cells in both exhausted and resident NK cells, I am going to fetch all the ICR ativated in MM in NK cells (exh + res) as starting point to run NicheNet.
